-- =================================================================
-- ==         !!! ОПАСНО !!! УДАЛЕНИЕ СТАРЫХ ЗАВЕРШЕННЫХ ТАЛОНОВ       ==
-- =================================================================
--
-- Назначение:
-- Удаляет талоны со статусом "завершен", которые были созданы
-- более 30 дней назад. Помогает поддерживать базу данных в чистоте.
--
-- psql -h localhost -p 5432 -U postgres -d el_queue -f scripts/archive_old_tickets.sql
--

DELETE FROM tickets
WHERE
    status = 'завершен'
    AND created_at < now() - interval '30 days'
RETURNING *; -- RETURNING * покажет в консоли, какие именно талоны были удалены.